---
permalink: klavararangxo
layout:    artru
title:     Моя раскладка клавиатуры
published: false
---
# Моя раскладка клавиатуры
Клавиатуры — отстой. На рынке нет ни одной хорошей клавиатуры. Они все ужасны,
отвратительны, грустны, неудобны, уродливы, грешны, порочны, обидчивы. Я говорю
про клавиатуры для компьютеров, на телефонах свои проблемы, но они не так
страшны.

Некоторые анонимные читатели давно знают о моей нелюбви ко всем клавиатурам,
некоторые о моей нелюбви не знают, но после этой статьи о ней узнают и тоже
невзлюбят. А может и нет.

Сначала немного истории.

## История
[В статьe в блоге ibnteo](http://ibnteo.klava.org/keyboard/standard) написана
вся порочная история стандартной клавиатуры, что не так и как мы вообще до
такого докатились. Рекомендую почитать, у него вообще интересный блог. Ему всё
настолько надоело, что он собрал свою клавиатуру мечты — поступок, которым я
восхищаюсь.

Если читать статью лень, то вот список тезисов (в скобочках мои комментарии):
> 1. Смещённые ряды, и это в эпоху компьютерных клавиатур, где клавиши 
>    нажимаются без усилия. Почему-то мало кто замечает этот недостаток.
> 2. Дополнительный блок клавиш справа, который мешает положить мышь рядом с 
>    рукой. Хотя уже выпускают множество компактных клавиатур, и есть отдельные 
>    цифровые модули для тех, кому они действительно нужны. В принципе можно 
>    уже не засчитывать как недостаток, но всё же, большинство клавиатур 
>    продаются именно с ним. (У моей клавиатуры есть такие модули. Блок с
>    цифрами критично бесполезен тем, что он так далеко. Стрелочки слишком
>    далеко. Там всё далеко, кошмар.)
> 3. Клавиши управления курсором отдельно, нет возможности управлять курсором 
>    прямо с основного блока клавиатуры. На многих ноутбуках эти клавиши 
>    настолько малы, что ими совершенно не удобно пользоваться. (Это можно
>    решить раскладкой: поставить в третий слой нужные клавиши, но это работает
>    не так надёжно.)
> 4. Раскладка Qwerty. Несмотря на то что изучать новую раскладку сложно, 
>    многие люди идут на это, чтобы изменить нагрузку на руки. Изменение 
>    раскладки самоё лёгкое, что можно сделать, ведь меняется она изменением 
>    настроек компьютера, и работает на всех клавиатурах. (А вот и неправда,
>    менять раскладку — дело для самых смелых. Вот поставлю я себе раскладку
>    эффективную, а потом на чужих компьютерах буду спотыкаться и беситься.)

Надо добавить пунктик про людей из стран с неанглийским языком. В таких странах
используют либо дурацкие надстройки над QWERTY, если у языка латиница, либо
используют сразу две раскладки, если письменность другая. В России как раз вот
так. Я слышал об украинцах с тремя раскладками. Легко могу представить
полиглота с шестью раскладками. 

## Борьба
Мысли о том, что клавиатуры ужасны будоражат умы ответственных граждан уже не
первый век. Создавались эффективные раскладки, но они не так хороши, пока на
них не перейдёт весь мир. Создавались эргономичные клавиатуры, но они либо
дорогие, либо дикие какие-то. Ну и само собой проблемы, связанные с текущим
зоопарком языков {общения, программирования}, операционных систем, программ и
всего такого.

В общем, не буду рассказывать про это. Xah на своём сайте уже [всё рассказал
за меня](http://xahlee.info/kbd/ergonomic_keyboards.html), но на английском.
Если непонятно, можно просто смотреть на красивые картинки эргономичных
клавиатур и с умным видом восхищаться.

Как же я ностальгирую по тем временам, когда меня не волновало, почему клавиши
расположены так, а не иначе, зачем мне эта клавиша, почему всё так плохо и
зачем мне цифровой блок так далеко. Раньше мне было легче. Но увы.

Просто взять и поменять клавиатуру на нормальную я не могу (таких нет), сделать
свою слишком трудоёмко. Поэтому я изменю свою раскладку.

## Что мне надо?
1. **Стандартное расположение букв.** Не потому что мне оно нравится, а потому
  что оно такое у всех. Знаки препинания и цифры можно и подвигать, если что,
  это не так критично.
2. **Курсорные клавиши поближе.** Мне лень тянуться к обычным стрелочкам и
  всему такому.
3. **Незачем поддерживать все ОС.** Я пользуюсь только одной — линуксом,
  поэтому поддерживать буду только его. Вполне возможно, моя раскладка может
  заработать на других юниксах, но кто же ими пользуется?
4. **Максимально простая установка**. Чтобы я мог запросто её поставитб когда
  надо куда надо. После обновления ядра, она может слететь. Для этого случая
  нужно подготовить простой скрипт.
5. Ну и по мелочи там.

## Как создать раскладку?
Я буду активно использовать командную строку. На линуксе за клавиатурные
раскладки отвечает программа `xkb`. Можно добавить свою раскладку, но это там
как-то сложно делается, у меня никогда не получалось. Зато всегда получалось
редактировать стандартную раскладку. С этим нужно быть осторожнее, если 
совершить ошибку, можно сломать ввод с клавиатуры. Я так делал, не рекомендую.

Я изменю две раскладки — русскую и английскую. Они обе лежат в одной папке.
Скопируем обе в отдельную папку и будем работать над ними в ней:
```bash
# Создаём папку для своих раскладок
mkdir ~/keyboard
# Перемещаемся в папку с раскладками, может быть в другом месте на разных ПК
cd /usr/share/X11/xkb/symbols
# Копируем их
cp us ru ~/keyboard
# Перемещаемся в папку со своими раскладками
cd ~/keyboard
```

Одной командой: `mkdir ~/keyboard; cp /usr/share/X11/xkb/symbols/ru
/usr/share/X11/xkb/symbols/us ~/keyboard/; cd ~/keyboard`.

Начнём с английской раскладки. Открываем в любимом текстовом редакторе:
```bash
vim us
```

Файл длинный, в нём очень много раскладок. Стандартная наверху, там так и 
написано: `default`. Меня интересует только она. Автор файла был не очень
аккуратный, поэтому я красиво вырованял текст:

```c
default  partial alphanumeric_keys modifier_keys
xkb_symbols "basic" {

  name[Group1]= "English (US)";

  key <TLDE> {[ grave, asciitilde ]};
  key <AE01> {[ 1,     exclam ]};
  key <AE02> {[ 2,     at ]};
  key <AE03> {[ 3,     numbersign ]};
  key <AE04> {[ 4,     dollar ]};
  key <AE05> {[ 5,     percent ]};
  key <AE06> {[ 6,     asciicircum ]};
  key <AE07> {[ 7,     ampersand ]};
  key <AE08> {[ 8,     asterisk ]};
  key <AE09> {[ 9,     parenleft ]};
  key <AE10> {[ 0,     parenright ]};
  key <AE11> {[ minus, underscore ]};
  key <AE12> {[ equal, plus ]};

  key <AD01> {[ q,            Q ]};
  key <AD02> {[ w,            W ]};
  key <AD03> {[ e,            E ]};
  key <AD04> {[ r,            R ]};
  key <AD05> {[ t,            T ]};
  key <AD06> {[ y,            Y ]};
  key <AD07> {[ u,            U ]};
  key <AD08> {[ i,            I ]};
  key <AD09> {[ o,            O ]};
  key <AD10> {[ p,            P ]};
  key <AD11> {[ bracketleft,  braceleft ]};
  key <AD12> {[ bracketright, braceright ]};

  key <AC01> {[ a,          A ]};
  key <AC02> {[ s,          S ]};
  key <AC03> {[ d,          D ]};
  key <AC04> {[ f,          F ]};
  key <AC05> {[ g,          G ]};
  key <AC06> {[ h,          H ]};
  key <AC07> {[ j,          J ]};
  key <AC08> {[ k,          K ]};
  key <AC09> {[ l,          L ]};
  key <AC10> {[ semicolon,  colon ]};
  key <AC11> {[ apostrophe, quotedbl ]};

  key <AB01> {[ z,      Z ]};
  key <AB02> {[ x,      X ]};
  key <AB03> {[ c,      C ]};
  key <AB04> {[ v,      V ]};
  key <AB05> {[ b,      B ]};
  key <AB06> {[ n,      N ]};
  key <AB07> {[ m,      M ]};
  key <AB08> {[ comma,  less ]};
  key <AB09> {[ period, greater ]};
  key <AB10> {[ slash,  question ]};

  key <BKSL> {[ backslash, bar ]};
};
```

To be continued...
